<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ API</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-case { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .result { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ API</h1>
    <p>–≠—Ç–æ—Ç —Ñ–∞–π–ª —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
    
    <div class="test-case">
        <h3>1. –¢–µ—Å—Ç –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ email</h3>
        <button onclick="testInvalidEmail()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–π email</button>
        <div id="test1-result" class="result"></div>
    </div>

    <div class="test-case">
        <h3>2. –¢–µ—Å—Ç –ø—É—Å—Ç—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π</h3>
        <button onclick="testEmptyFields()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ –ø–æ–ª—è</button>
        <div id="test2-result" class="result"></div>
    </div>

    <div class="test-case">
        <h3>3. –¢–µ—Å—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è email</h3>
        <button onclick="testDuplicateEmail()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ email</button>
        <div id="test3-result" class="result"></div>
    </div>

    <div class="test-case">
        <h3>4. –¢–µ—Å—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è username</h3>
        <button onclick="testDuplicateUsername()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ username</button>
        <div id="test4-result" class="result"></div>
    </div>

    <div class="test-case">
        <h3>5. –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</h3>
        <button onclick="testValidUser()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <div id="test5-result" class="result"></div>
    </div>

    <script>
        const API_BASE = `${window.location.protocol}//${window.location.hostname}:${window.location.port}/api`;

        async function makeRequest(data) {
            try {
                const response = await fetch(`${API_BASE}/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                return { status: response.status, data: result };
            } catch (error) {
                return { status: 0, data: { error: error.message } };
            }
        }

        function displayResult(elementId, result, expectedStatus) {
            const element = document.getElementById(elementId);
            const isExpected = result.status === expectedStatus;
            
            element.className = `result ${isExpected ? 'success' : 'error'}`;
            element.innerHTML = `
                <strong>–°—Ç–∞—Ç—É—Å:</strong> ${result.status} ${isExpected ? '‚úÖ' : '‚ùå'}<br>
                <strong>–û—Ç–≤–µ—Ç:</strong>
                <pre>${JSON.stringify(result.data, null, 2)}</pre>
            `;
        }

        async function testInvalidEmail() {
            const result = await makeRequest({
                name: "–¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                email: "–Ω–µ–≤–µ—Ä–Ω—ã–π-email",
                username: "testuser"
            });
            displayResult('test1-result', result, 400);
        }

        async function testEmptyFields() {
            const result = await makeRequest({
                name: "",
                email: "",
                username: ""
            });
            displayResult('test2-result', result, 400);
        }

        async function testDuplicateEmail() {
            // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await makeRequest({
                name: "–ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                email: "duplicate@test.com",
                username: "firstuser"
            });

            // –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å —Å —Ç–µ–º –∂–µ email
            const result = await makeRequest({
                name: "–í—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                email: "duplicate@test.com",
                username: "seconduser"
            });
            displayResult('test3-result', result, 409);
        }

        async function testDuplicateUsername() {
            // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await makeRequest({
                name: "–ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                email: "first@test.com",
                username: "duplicateuser"
            });

            // –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å —Å —Ç–µ–º –∂–µ username
            const result = await makeRequest({
                name: "–í—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", 
                email: "second@test.com",
                username: "duplicateuser"
            });
            displayResult('test4-result', result, 409);
        }

        async function testValidUser() {
            const timestamp = Date.now();
            const result = await makeRequest({
                name: "–í–∞–ª–∏–¥–Ω—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                email: `valid${timestamp}@test.com`,
                username: `validuser${timestamp}`,
                phone: "+1234567890",
                website: "https://example.com",
                company: "Test Company"
            });
            displayResult('test5-result', result, 201);
        }
    </script>
</body>
</html>
